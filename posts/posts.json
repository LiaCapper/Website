[
  {
    "path": "posts/2021-05-14-week-10-report/",
    "title": "Week 10 Report",
    "description": "Model for Charitable Donations as predicted by Age and Religious Group.",
    "author": [
      {
        "name": "Lia",
        "url": {}
      }
    ],
    "date": "2021-05-12",
    "categories": [],
    "contents": "\r\n\r\n\r\n\r\n\r\n\r\n\r\nWrite a varying intercept/varying slope model.\r\nVariables\r\nCharityDonate\r\n\r\nHow much money have you donated to charity in the last year?\r\n\r\nPredicted by\r\nAge\r\n\r\nWhat is your age?\r\n\r\nGrouped by\r\nBigDoms\r\n\r\nWhat religion or spiritual group? Christian, Buddhist, Muslim, Not Religious, Other\r\n\r\nDesrciptive Statistics\r\n\r\nhtml {\r\n  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;\r\n}\r\n\r\n#scjbedtoke .gt_table {\r\n  display: table;\r\n  border-collapse: collapse;\r\n  margin-left: auto;\r\n  margin-right: auto;\r\n  color: #333333;\r\n  font-size: 16px;\r\n  font-weight: normal;\r\n  font-style: normal;\r\n  background-color: #FFFFFF;\r\n  width: auto;\r\n  border-top-style: solid;\r\n  border-top-width: 2px;\r\n  border-top-color: #A8A8A8;\r\n  border-right-style: none;\r\n  border-right-width: 2px;\r\n  border-right-color: #D3D3D3;\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #A8A8A8;\r\n  border-left-style: none;\r\n  border-left-width: 2px;\r\n  border-left-color: #D3D3D3;\r\n}\r\n\r\n#scjbedtoke .gt_heading {\r\n  background-color: #FFFFFF;\r\n  text-align: center;\r\n  border-bottom-color: #FFFFFF;\r\n  border-left-style: none;\r\n  border-left-width: 1px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 1px;\r\n  border-right-color: #D3D3D3;\r\n}\r\n\r\n#scjbedtoke .gt_title {\r\n  color: #333333;\r\n  font-size: 125%;\r\n  font-weight: initial;\r\n  padding-top: 4px;\r\n  padding-bottom: 4px;\r\n  border-bottom-color: #FFFFFF;\r\n  border-bottom-width: 0;\r\n}\r\n\r\n#scjbedtoke .gt_subtitle {\r\n  color: #333333;\r\n  font-size: 85%;\r\n  font-weight: initial;\r\n  padding-top: 0;\r\n  padding-bottom: 4px;\r\n  border-top-color: #FFFFFF;\r\n  border-top-width: 0;\r\n}\r\n\r\n#scjbedtoke .gt_bottom_border {\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n}\r\n\r\n#scjbedtoke .gt_col_headings {\r\n  border-top-style: solid;\r\n  border-top-width: 2px;\r\n  border-top-color: #D3D3D3;\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n  border-left-style: none;\r\n  border-left-width: 1px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 1px;\r\n  border-right-color: #D3D3D3;\r\n}\r\n\r\n#scjbedtoke .gt_col_heading {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  font-size: 100%;\r\n  font-weight: normal;\r\n  text-transform: inherit;\r\n  border-left-style: none;\r\n  border-left-width: 1px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 1px;\r\n  border-right-color: #D3D3D3;\r\n  vertical-align: bottom;\r\n  padding-top: 5px;\r\n  padding-bottom: 6px;\r\n  padding-left: 5px;\r\n  padding-right: 5px;\r\n  overflow-x: hidden;\r\n}\r\n\r\n#scjbedtoke .gt_column_spanner_outer {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  font-size: 100%;\r\n  font-weight: normal;\r\n  text-transform: inherit;\r\n  padding-top: 0;\r\n  padding-bottom: 0;\r\n  padding-left: 4px;\r\n  padding-right: 4px;\r\n}\r\n\r\n#scjbedtoke .gt_column_spanner_outer:first-child {\r\n  padding-left: 0;\r\n}\r\n\r\n#scjbedtoke .gt_column_spanner_outer:last-child {\r\n  padding-right: 0;\r\n}\r\n\r\n#scjbedtoke .gt_column_spanner {\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n  vertical-align: bottom;\r\n  padding-top: 5px;\r\n  padding-bottom: 6px;\r\n  overflow-x: hidden;\r\n  display: inline-block;\r\n  width: 100%;\r\n}\r\n\r\n#scjbedtoke .gt_group_heading {\r\n  padding: 8px;\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  font-size: 100%;\r\n  font-weight: initial;\r\n  text-transform: inherit;\r\n  border-top-style: solid;\r\n  border-top-width: 2px;\r\n  border-top-color: #D3D3D3;\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n  border-left-style: none;\r\n  border-left-width: 1px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 1px;\r\n  border-right-color: #D3D3D3;\r\n  vertical-align: middle;\r\n}\r\n\r\n#scjbedtoke .gt_empty_group_heading {\r\n  padding: 0.5px;\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  font-size: 100%;\r\n  font-weight: initial;\r\n  border-top-style: solid;\r\n  border-top-width: 2px;\r\n  border-top-color: #D3D3D3;\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n  vertical-align: middle;\r\n}\r\n\r\n#scjbedtoke .gt_from_md > :first-child {\r\n  margin-top: 0;\r\n}\r\n\r\n#scjbedtoke .gt_from_md > :last-child {\r\n  margin-bottom: 0;\r\n}\r\n\r\n#scjbedtoke .gt_row {\r\n  padding-top: 8px;\r\n  padding-bottom: 8px;\r\n  padding-left: 5px;\r\n  padding-right: 5px;\r\n  margin: 10px;\r\n  border-top-style: solid;\r\n  border-top-width: 1px;\r\n  border-top-color: #D3D3D3;\r\n  border-left-style: none;\r\n  border-left-width: 1px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 1px;\r\n  border-right-color: #D3D3D3;\r\n  vertical-align: middle;\r\n  overflow-x: hidden;\r\n}\r\n\r\n#scjbedtoke .gt_stub {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  font-size: 100%;\r\n  font-weight: initial;\r\n  text-transform: inherit;\r\n  border-right-style: solid;\r\n  border-right-width: 2px;\r\n  border-right-color: #D3D3D3;\r\n  padding-left: 12px;\r\n}\r\n\r\n#scjbedtoke .gt_summary_row {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  text-transform: inherit;\r\n  padding-top: 8px;\r\n  padding-bottom: 8px;\r\n  padding-left: 5px;\r\n  padding-right: 5px;\r\n}\r\n\r\n#scjbedtoke .gt_first_summary_row {\r\n  padding-top: 8px;\r\n  padding-bottom: 8px;\r\n  padding-left: 5px;\r\n  padding-right: 5px;\r\n  border-top-style: solid;\r\n  border-top-width: 2px;\r\n  border-top-color: #D3D3D3;\r\n}\r\n\r\n#scjbedtoke .gt_grand_summary_row {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  text-transform: inherit;\r\n  padding-top: 8px;\r\n  padding-bottom: 8px;\r\n  padding-left: 5px;\r\n  padding-right: 5px;\r\n}\r\n\r\n#scjbedtoke .gt_first_grand_summary_row {\r\n  padding-top: 8px;\r\n  padding-bottom: 8px;\r\n  padding-left: 5px;\r\n  padding-right: 5px;\r\n  border-top-style: double;\r\n  border-top-width: 6px;\r\n  border-top-color: #D3D3D3;\r\n}\r\n\r\n#scjbedtoke .gt_striped {\r\n  background-color: rgba(128, 128, 128, 0.05);\r\n}\r\n\r\n#scjbedtoke .gt_table_body {\r\n  border-top-style: solid;\r\n  border-top-width: 2px;\r\n  border-top-color: #D3D3D3;\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n}\r\n\r\n#scjbedtoke .gt_footnotes {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  border-bottom-style: none;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n  border-left-style: none;\r\n  border-left-width: 2px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 2px;\r\n  border-right-color: #D3D3D3;\r\n}\r\n\r\n#scjbedtoke .gt_footnote {\r\n  margin: 0px;\r\n  font-size: 90%;\r\n  padding: 4px;\r\n}\r\n\r\n#scjbedtoke .gt_sourcenotes {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  border-bottom-style: none;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n  border-left-style: none;\r\n  border-left-width: 2px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 2px;\r\n  border-right-color: #D3D3D3;\r\n}\r\n\r\n#scjbedtoke .gt_sourcenote {\r\n  font-size: 90%;\r\n  padding: 4px;\r\n}\r\n\r\n#scjbedtoke .gt_left {\r\n  text-align: left;\r\n}\r\n\r\n#scjbedtoke .gt_center {\r\n  text-align: center;\r\n}\r\n\r\n#scjbedtoke .gt_right {\r\n  text-align: right;\r\n  font-variant-numeric: tabular-nums;\r\n}\r\n\r\n#scjbedtoke .gt_font_normal {\r\n  font-weight: normal;\r\n}\r\n\r\n#scjbedtoke .gt_font_bold {\r\n  font-weight: bold;\r\n}\r\n\r\n#scjbedtoke .gt_font_italic {\r\n  font-style: italic;\r\n}\r\n\r\n#scjbedtoke .gt_super {\r\n  font-size: 65%;\r\n}\r\n\r\n#scjbedtoke .gt_footnote_marks {\r\n  font-style: italic;\r\n  font-size: 65%;\r\n}\r\n\r\n        Descriptive Statistics\r\n      \r\n    Variable\r\n      N = 22,3961\r\n    Annual Charitable Donations\r\n      955.52 (5,613.75)\r\n    (Missing)\r\n      891\r\n    Age\r\n      53.33 (14.14)\r\n    Religious Group\r\n      \r\n    Buddhist\r\n      147 (0.7%)\r\n    Christian\r\n      7,719 (35%)\r\n    Muslim\r\n      29 (0.1%)\r\n    Not_Rel\r\n      13,210 (60%)\r\n    TheOthers\r\n      940 (4.3%)\r\n    (Missing)\r\n      351\r\n    \r\n        \r\n          1\r\n          \r\n           \r\n          Mean (SD); n (%)\r\n          \r\n      \r\n    \r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nResults\r\nThe model used is multi level with group varying slopes\r\n\r\n Family: gaussian \r\n  Links: mu = identity; sigma = identity \r\nFormula: CharityDonate ~ 1 + Age + (1 + Age | BigDoms) \r\n   Data: df (Number of observations: 21301) \r\nSamples: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;\r\n         total post-warmup samples = 4000\r\n\r\nGroup-Level Effects: \r\n~BigDoms (Number of levels: 5) \r\n                   Estimate Est.Error l-95% CI u-95% CI\r\nsd(Intercept)          0.99      1.02     0.02     3.73\r\nsd(Age)                9.97      1.71     7.16    13.82\r\ncor(Intercept,Age)    -0.01      0.45    -0.82     0.80\r\n                   Rhat Bulk_ESS Tail_ESS\r\nsd(Intercept)      1.00     3059     1604\r\nsd(Age)            1.00     2290     2299\r\ncor(Intercept,Age) 1.00      762     1478\r\n\r\nPopulation-Level Effects: \r\n          Estimate Est.Error l-95% CI u-95% CI Rhat\r\nIntercept   394.81    131.87   138.79   651.25 1.00\r\nAge          -7.31      2.47   -12.12    -2.51 1.00\r\n          Bulk_ESS Tail_ESS\r\nIntercept     4335     2996\r\nAge           4330     3070\r\n\r\nFamily Specific Parameters: \r\n      Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS\r\nsigma  5047.49     21.60  5004.83  5089.47 1.00     5901\r\n      Tail_ESS\r\nsigma     3169\r\n\r\nSamples were drawn using sampling(NUTS). For each parameter, Bulk_ESS\r\nand Tail_ESS are effective sample size measures, and Rhat is the potential\r\nscale reduction factor on split chains (at convergence, Rhat = 1).\r\n\r\nPlots\r\n\r\n\r\n\r\nGraph\r\n\r\n\r\n\r\nWe fitted a Bayesian linear mixed model (estimated using MCMC sampling with 4 chains of 2000 iterations and a warmup of 1000) to predict CharityDonate with Age (formula: CharityDonate ~ 1 + Age). The model included Age and BigDoms as random effects (formula: ~1 + Age | BigDoms). Priors over parameters were set as normal (mean = normal(-1, 10), SD = 10.00) distributions. The model’s explanatory power is very weak (R2 = 8.92e-03, 89% CI [6.94e-03, 0.01], adj. R2 = 8.51e-03) and the part related to the fixed effects alone (marginal R2) is of 3.35e-04 (89% CI [2.44e-05, 6.95e-04]). Within this model:\r\nThe effect of b_Intercept (Median = 394.20, 95% CI [141.02, 652.51]) has a 99.90% probability of being positive (> 0), 80.35% of being significant (> 281.90), and 0.00% of being large (> 1691.42). The estimation successfully converged (Rhat = 1.000) and the indices are reliable (ESS = 4297)\r\nThe effect of b_Age (Median = -7.31, 95% CI [-12.20, -2.59]) has a 99.88% probability of being negative (< 0), 0.00% of being significant (< -281.90), and 0.00% of being large (< -1691.42). The estimation successfully converged (Rhat = 1.000) and the indices are reliable (ESS = 4301)\r\nFollowing the Sequential Effect eXistence and sIgnificance Testing (SEXIT) framework, we report the median of the posterior distribution and its 95% CI (Highest Density Interval), along the probability of direction (pd), the probability of significance and the probability of being large. The thresholds beyond which the effect is considered as significant (i.e., non-negligible) and large are |281.90| and |1691.42| (corresponding respectively to 0.05 and 0.30 of the outcome’s SD). Convergence and stability of the Bayesian sampling has been assessed using R-hat, which should be below 1.01 (Vehtari et al., 2019), and Effective Sample Size (ESS), which should be greater than 1000 (Burkner, 2017).\r\nConclusion\r\nAge negatively predicted charitable donations. Individuals religious identities were correlated.\r\n\r\nApendix\r\n\r\n\r\n### Libraries\r\nlibrary(\"tidyverse\")\r\nlibrary(\"patchwork\")\r\nlibrary(\"lubridate\")\r\nlibrary(\"kableExtra\")\r\nlibrary(\"gtsummary\")\r\nlibrary(\"lubridate\")\r\nlibrary(\"equatiomatic\")\r\nlibrary(\"ggdag\")\r\nlibrary(\"brms\")\r\nlibrary(\"rstan\")\r\nlibrary(\"rstanarm\")\r\nlibrary(\"bayesplot\")\r\nlibrary(\"easystats\")\r\nlibrary(\"kableExtra\")\r\nlibrary(\"broom\")\r\nlibrary(\"tidybayes\")\r\nlibrary(\"bmlm\")\r\n# if (!require(tidyLPA)) {\r\n#   install.packages(\"tidyLPA\")\r\n# }\r\n# rstan options\r\nrstan_options(auto_write = TRUE)\r\noptions(mc.cores = parallel::detectCores ())\r\ntheme_set(theme_classic())\r\n\r\n\r\n\r\n\r\n\r\nnz_0 <- as.data.frame(readr::read_csv2(\r\n  url(\r\n    \"https://raw.githubusercontent.com/go-bayes/psych-447/main/data/nzj.csv\"\r\n  )\r\n))\r\n\r\n# to relevel kessler 6 variables\r\nf <-\r\n  c(\r\n    \"None Of The Time\",\r\n    \"A Little Of The Time\",\r\n    \"Some Of The Time\",\r\n    \"Most Of The Time\",\r\n    \"All Of The Time\"\r\n  )\r\n\r\n\r\n\r\n# get data into shape\r\ndf <- nz_0 %>%\r\n  dplyr::mutate_if(is.character, factor) %>%\r\n  select(\r\n    -c(\r\n      SWB.Kessler01,\r\n      SWB.Kessler02,\r\n      SWB.Kessler03,\r\n      SWB.Kessler04,\r\n      SWB.Kessler05,\r\n      SWB.Kessler06\r\n    )\r\n  ) %>%\r\n  dplyr::mutate(Wave = as.factor(Wave)) %>%\r\n  dplyr::mutate(FeelHopeless = forcats::fct_relevel(FeelHopeless, f)) %>%\r\n  dplyr::mutate(FeelDepressed = forcats::fct_relevel(FeelDepressed, f)) %>%\r\n  dplyr::mutate(FeelRestless = forcats::fct_relevel(FeelRestless, f)) %>%\r\n  dplyr::mutate(EverythingIsEffort = forcats::fct_relevel(EverythingIsEffort, f)) %>%\r\n  dplyr::mutate(FeelWorthless = forcats::fct_relevel(FeelWorthless, f)) %>%\r\n  dplyr::mutate(FeelNervous = forcats::fct_relevel(FeelNervous, f)) %>%\r\n  dplyr::mutate(Wave = as.factor(Wave)) %>%\r\n  dplyr::mutate(male_id = as.factor(Male)) %>%\r\n  dplyr::mutate(date = make_date(year = 2009, month = 6, day = 30) + TSCORE) %>%\r\n  dplyr::mutate(\r\n    FeelWorthless_int = as.integer(FeelWorthless),\r\n    FeelNervous_int =  as.integer(FeelNervous),\r\n    FeelHopeless_int =  as.integer(FeelHopeless),\r\n    EverythingIsEffort_int =  as.integer(EverythingIsEffort),\r\n    FeelRestless_int =  as.integer(FeelRestless),\r\n    FeelDepressed_int =  as.integer(FeelDepressed),\r\n    HLTH.Fatigue_int = as.integer(HLTH.Fatigue + 1)\r\n  ) %>%\r\n  dplyr::mutate(yearS = TSCORE - min(TSCORE, na.rm = TRUE)) %>%\r\n  dplyr::mutate(KESSLER6sum = as.integer(KESSLER6sum))\r\n\r\n\r\n\r\nMethod\r\n\r\n\r\n# Create Model\r\ndf %>%\r\n  dplyr::select(CharityDonate,\r\n                Age,\r\n                BigDoms) %>%\r\n  gtsummary::tbl_summary(\r\n    label = list(CharityDonate~\"Annual Charitable Donations\",\r\n                  BigDoms~\"Religious Group\"),\r\n    statistic = list(\r\n      all_continuous() ~ \"{mean} ({sd})\"\r\n    ),\r\n    digits = all_continuous() ~ 2,\r\n    missing_text = \"(Missing)\"\r\n  ) %>%\r\n   modify_header(label~\"Variable\")%>%\r\n  modify_spanning_header(c(\"label\",\"stat_0\")~\"Descriptive Statistics\")%>%\r\n  bold_labels()\r\n\r\n\r\n\r\n\r\n\r\n# Bar Graph\r\nplot(df$BigDoms, main=\"Religious Groups\")\r\n\r\n\r\n\r\n\r\n\r\nFALSE\r\n\r\n\r\n\r\nResults\r\n\r\n\r\n# Create Model\r\nm_vslopes  <-\r\n  brm(\r\n    CharityDonate ~ 1 + Age + (1 + Age | BigDoms),\r\n    prior = c(\r\n      prior(normal(5, 2), class = Intercept),\r\n      prior(normal(-1, 10), class = b),\r\n      prior(exponential(1), class = sd),\r\n      prior(exponential(1), class = sigma),\r\n      prior(lkj(2), class = cor)\r\n    ),\r\n    file = here::here(\"models\", \"multi-level-var-slopes\"),\r\n    data = df,\r\n    family = gaussian)\r\nsummary(m_vslopes)\r\n\r\n\r\n\r\n\r\n\r\n# Plot\r\np1 <- brms::mcmc_plot(m_vslopes)\r\np1\r\n\r\n\r\n\r\n\r\n\r\n#Graphing Model\r\nconditional_effects(m_vslopes)\r\n\r\n\r\n\r\n\r\n\r\n\r\n",
    "preview": "posts/2021-05-14-week-10-report/week-10-report_files/figure-html5/1.2-1.png",
    "last_modified": "2021-05-14T10:55:25+12:00",
    "input_file": {}
  }
]
